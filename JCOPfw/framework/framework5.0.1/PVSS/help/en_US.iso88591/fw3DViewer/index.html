<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>fw3DViewer:&nbsp;3D-Viewer&nbsp;widget: fw3DViewer: JCOP Framework 3D-Viewer widget</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fw3DViewer.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>fw3DViewer: JCOP Framework 3D-Viewer widget</h1><h3>version&nbsp;5.0.1 </h3><p>The fw3DWidget is a WinCC OA widget for represent 3D graphics The JCOP Framework 3D-Viewer widget is an extension of WinCC OA User Interface allowing to display 3-dimensional view ("scene") made of various geometrical objects. It allows to navigate, and interact with these object making the experience of the user interface very attractive and intuitive.</p>
<div align="center">
<img src="fw3DViewer_demo1.png" alt="fw3DViewer_demo1.png"/>
<p><strong>An example of a WinCC OA panel with fw3DViewer displaying a dummy detector</strong></p></div>
<p> It is a WinCC OA EWO (External Widget Object) UI component that could be embedded into any WinCC OA panel. The viewer is generic: the objects displayed in the scene are created and modified using standard WinCC OA scripts, and the interaction (such as clicking in an object) is also scriptable.</p>
<p>This is the initial version of the documentation; we are aware that it lacks the completness and is not giving enough introduction. Please contact the authors if you need more information.</p>
<h2><a class="anchor" id="ShapesTypesScenes">
Shapes, Shape Types and the Scene</a></h2>
<p>The widget displays the view of a so called "Scene": a volume filled with "Shapes". Each Shape is an instance of a Shape Type; there is a set of shape types that are available in the widget - they are documented below. Each shape is identified (and addressed) by a unique name. Each shape has individual set of properties, which define its geometry (placement, rotation, lenths of edges, radiuses, etc), and visual appearance (colour, transparency)</p>
<p>For instance, a scene may be composed of three cubes: "Cube1", "Cube2", "Cube3", each of which is of type "Box". Each of them may have a different colour, transparency, and placement. Each of them may be moved/changed independently of the others.</p>
<p>When the widget is placed in the panel, its scene is initially empty. It is the role of the panel programmer, to use the functions to add shapes to it. Typically, this should be done in the <code>init</code> script of the widget, or the init script of the panel. By default, when the widget is created, it contains the scene view itself (initially an empty area of navy-blue colour), and a set of additional elements called "decorations". The "decorations" elements are three "wheels" that allow to navigate the scene (two in the bottom-left corner, one in bottom-right corner), and a vertical button bar allowing to change the viewer behaviour. The decorations may be hidden (and later shown) either using the context menu (brought up by a right-click), or using the <a class="el" href="classfw3DViewer.html#a9a3ec693d4d09b402b977b269939fc2b">fw3DViewer::setDecoration</a> function.</p>
<p>Note that a panel may contain more than one instance of <a class="el" href="classfw3DViewer.html">fw3DViewer</a>, and all these instances are independent and may be manipulated independently</p>
<h2><a class="anchor" id="OperationModes">
Modes of operation of the widget, navigating in the scene</a></h2>
<p>The widget has two modes of operation: <em>"Viewing"</em> and <em>"Picking"</em>.</p>
<p>In the "Viewing" mode, the mouse may be used to navigate in the scene: </p>
<ul>
<li>dragging with left-mouse-button pressed rotates the scene </li>
<li>dragging with middle-mouse-button pressed pans the scene </li>
<li>scrolling-wheel zooms in or zooms out ("dollies") the scene </li>
<li>righ-clicking in the scene brings out a context-menu with 3D-specific settings</li>
</ul>
<p>In the "Picking" mode, the mouse is used to interact with the object. Clicking in the object triggers the <a class="el" href="classfw3DViewer.html#ae775000f5d38806e66a53bd9c97e1e57">fw3DViewer::shapeClicked</a> event, which may then be served by a dedicated WinCC OA script. Note that in this mode the navigation in the scene is not possible.</p>
<p>To switch between the "Viewing" and "Picking" mode, the following may be used: </p>
<ul>
<li>the user can press the "Esc" key while the mouse cursor is in the scene </li>
<li>if the widget has "decorations" (additional buttons bar in the right) visible, one can use the button with a "hand" icon to switch to the "Viewing" mode, and the "arrow" button to switch to the "Picking" mode </li>
<li>In the "Viewing" mode, one can right-click to bring up the context menu, and unselect the "Viewing" option to enter the "Picking" mode </li>
<li>From a WinCC OA script, one can use teh <a class="el" href="classfw3DViewer.html#aaf45c76ff698c0b49cb3540179dc782f">fw3DViewer::setViewing</a> function to change the mode</li>
</ul>
<p>Navigation in the scene may also be done using the "go to" functionality: it will navigate in the scene (rotate, zoom), so that the desired shape is visible at the center. To navigate to a certain shape, one should use the <a class="el" href="classfw3DViewer.html#ab3d8ac9a1192ec462fa6b358452ab606">fw3DViewer::seekToShape</a> function, passing the name of the shape to it. One could also use <a class="el" href="classfw3DViewer.html#a670debbb309a52879dc40ddea6920869">fw3DViewer::setSeek</a> to activate the "seek mode"; in the "seek mode", the scene will navigate to a shape that was clicked.</p>
<h2><a class="anchor" id="ShapeTypes">
Available Shape Types and Their Parameters</a></h2>
<p>The following shape types are available in this release:</p>
<h3><a class="anchor" id="Shape_Box">
Box</a></h3>
<p>A Box is a cuboid of given half lengths <code>dx</code>, <code>dy</code>, <code>dz</code> . The Box is centred on the origin with sides parallel to the x/y/z axes.</p>
<p>Available Geometry Properties: </p>
<ul>
<li><code>"x"</code>,"y","z" - position of the shape, in x,y,z direction </li>
<li><code>"position"</code> - position of the shape specified as a string of 3 floats (for x, y and z); alternative to the <code>"x"</code>, <code>"y"</code> and <code>"z"</code> properties </li>
<li><code>"rotationMatrix"</code> or <code>"rotation"</code> - 3x3 rotation matrix, passed as a string of 9 float numbers separated by commas; the <code>"rotation"</code> property is now deprecated - it is a synonym of <code>"rotationMatrix"</code> </li>
<li><code>"rotationAngle"</code> - rotation specified by an axis and angle; passed as a string of 4 float numbers: the first three being the vector that defines the axis, the fourth being the rotation angle in radians. <code>"rotationAngle"</code> is an alternative to <code>"rotationMatrix"</code> </li>
<li><code>"dx"</code>,"dy","dz" - half-lengths along the x,y and z axis</li>
</ul>
<p>Example </p>
<div class="fragment"><pre class="fragment"> myShape.addShape(<span class="stringliteral">&quot;Box&quot;</span>,<span class="stringliteral">&quot;MyExampleBox&quot;</span>,
          makeDynString(<span class="stringliteral">&quot;x&quot;</span>,<span class="stringliteral">&quot;1.0&quot;</span>,
                        <span class="stringliteral">&quot;y&quot;</span>,<span class="stringliteral">&quot;2.0&quot;</span>,
                        <span class="stringliteral">&quot;z&quot;</span>,<span class="stringliteral">&quot;3.0&quot;</span>,
                        <span class="stringliteral">&quot;dx&quot;</span>,<span class="stringliteral">&quot;1.0&quot;</span>,
                        <span class="stringliteral">&quot;dy&quot;</span>,<span class="stringliteral">&quot;2.0&quot;</span>
                        <span class="stringliteral">&quot;dz&quot;</span>,<span class="stringliteral">&quot;4.0&quot;</span>,
                        <span class="stringliteral">&quot;rotationMatrix&quot;</span>,<span class="stringliteral">&quot;0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0&quot;</span>
          )
 );
</pre></div><h3><a class="anchor" id="Shape_Sphere">
Sphere</a></h3>
<p>a sphere with radius <code>r</code> </p>
<p>Available Geometry Properties </p>
<ul>
<li><code>"x"</code>,"y","z" - position of the shape </li>
<li><code>"position"</code> - position of the shape specified as a string of 3 floats (for x, y and z); alternative to the <code>"x"</code>, <code>"y"</code> and <code>"z"</code> properties </li>
<li><code>"r"</code> - sphere radius</li>
</ul>
<h3><a class="anchor" id="Shape_Cone">
Cone</a></h3>
<p>a Phi segment of a cone, with half-length <code>dz</code>, inner and outer radii specified at <code>-dz</code> and <code>+dz</code>. The Phi segment is described by a starting <code>startphi</code> angle, and the <code>deltaphi</code> delta angle for the shape. If the delta angle is &gt;=2*M_PI, the shape is treated as continuous in Phi.</p>
<p>Available Geometry Properties </p>
<ul>
<li><code>"x"</code>,"y","z" - position of the shape </li>
<li><code>"position"</code> - position of the shape specified as a string of 3 floats (for x, y and z); alternative to the <code>"x"</code>, <code>"y"</code> and <code>"z"</code> properties </li>
<li><code>"rotationMatrix"</code> or <code>"rotation"</code> - 3x3 rotation matrix, passed as a string of 9 float numbers separated by commas; the <code>"rotation"</code> property is now deprecated - it is a synonym of <code>"rotationMatrix"</code> </li>
<li><code>"rotationAngle"</code> - rotation specified by an axis and angle; passed as a string of 4 float numbers: the first three being the vector that defines the axis, the fourth being the rotation angle in radians. <code>"rotationAngle"</code> is an alternative to <code>"rotationMatrix"</code> </li>
<li><code>"dz"</code> - half-length in z </li>
<li><code>"radiusMin"</code> - inside radius at -dz. </li>
<li><code>"radiusMax"</code> - ouside radius at -dz. </li>
<li><code>"radiusMin2"</code> - inside radius at +dz. </li>
<li><code>"radiusMax2"</code> - outside radius at +dz. </li>
<li><code>"startPhi"</code> - starting angle of the segment in radians. </li>
<li><code>"deltaPhi"</code> - delta angle of the segment in radians.</li>
</ul>
<h3><a class="anchor" id="Shape_Tube">
Tube</a></h3>
<p>A tube or tube segment with curved sides parallel to the z-axis.</p>
<p>The tube has a specified half-length along the z axis, about which it is centred, and a given minimum and maximum radius. A minimum radius of 0 signifies a filled tube /cylinder. The tube segment is specified by starting and delta angles for phi, with 0 being the +x axis, PI/2 the +y axis. A delta angle of 2PI signifies a complete, unsegmented tube/cylinder.</p>
<p>Available Geometry Properties: </p>
<ul>
<li><code>"x"</code>,"y","z" - position of the shape </li>
<li><code>"position"</code> - position of the shape specified as a string of 3 floats (for x, y and z); alternative to the <code>"x"</code>, <code>"y"</code> and <code>"z"</code> properties </li>
<li><code>"rotationMatrix"</code> or <code>"rotation"</code> - 3x3 rotation matrix, passed as a string of 9 float numbers separated by commas; the <code>"rotation"</code> property is now deprecated - it is a synonym of <code>"rotationMatrix"</code> </li>
<li><code>"rotationAngle"</code> - rotation specified by an axis and angle; passed as a string of 4 float numbers: the first three being the vector that defines the axis, the fourth being the rotation angle in radians. <code>"rotationAngle"</code> is an alternative to <code>"rotationMatrix"</code> </li>
<li><code>"dz"</code> - half-length in z </li>
<li><code>"radiusMin"</code> - inside radius of the tube. </li>
<li><code>"radiusMax"</code> - outside radius of the tube. </li>
<li><code>"startPhi"</code> - starting angle, in radians. </li>
<li><code>"deltaPhi"</code> - delta-angle, in radians.</li>
</ul>
<h3><a class="anchor" id="Shape_Trd">
Trd</a></h3>
<p>A Trd is a trapezoid with the x and y dimensions varying along z.</p>
<p>Available Geometry Properties: </p>
<ul>
<li><code>"x"</code>,"y","z" - position of the shape </li>
<li><code>"position"</code> - position of the shape specified as a string of 3 floats (for x, y and z); alternative to the <code>"x"</code>, <code>"y"</code> and <code>"z"</code> properties </li>
<li><code>"rotationMatrix"</code> or <code>"rotation"</code> - 3x3 rotation matrix, passed as a string of 9 float numbers separated by commas; the <code>"rotation"</code> property is now deprecated - it is a synonym of <code>"rotationMatrix"</code> </li>
<li><code>"rotationAngle"</code> - rotation specified by an axis and angle; passed as a string of 4 float numbers: the first three being the vector that defines the axis, the fourth being the rotation angle in radians. <code>"rotationAngle"</code> is an alternative to <code>"rotationMatrix"</code> </li>
<li><code>"dz"</code> - half-length in z </li>
<li><code>"dx"</code> - half-length of x, at -dz. </li>
<li><code>"dx2"</code> - half-length of x, at +dz. </li>
<li><code>"dy"</code> - half-length of y, at -dz. </li>
<li><code>"dy2"</code> - half-length of y, at +dz.</li>
</ul>
<h3><a class="anchor" id="Shape_Trapezoid">
Trapezoid</a></h3>
<p>general trapezoid: The faces perpendicular to the z planes are tapezia, and their centres are not necessarily on a line parallel to the z axis.</p>
<p>Available Geometry Properties: </p>
<ul>
<li><code>"x"</code>,"y","z" - position of the shape </li>
<li><code>"position"</code> - position of the shape specified as a string of 3 floats (for x, y and z); alternative to the <code>"x"</code>, <code>"y"</code> and <code>"z"</code> properties </li>
<li><code>"rotationMatrix"</code> or <code>"rotation"</code> - 3x3 rotation matrix, passed as a string of 9 float numbers separated by commas; the <code>"rotation"</code> property is now deprecated - it is a synonym of <code>"rotationMatrix"</code> </li>
<li><code>"rotationAngle"</code> - rotation specified by an axis and angle; passed as a string of 4 float numbers: the first three being the vector that defines the axis, the fourth being the rotation angle in radians. <code>"rotationAngle"</code> is an alternative to <code>"rotationMatrix"</code> </li>
<li><code>"dz"</code> - half-length in z </li>
<li><code>"theta"</code> - polar angle of the line joining the centres of the faces at -/+dz. </li>
<li><code>"phi"</code> - azimuthal angle of the line joing the centre of the face at -dz to the centre of the face at +dz. </li>
<li><code>"h1"</code> - half-length along y of the face at -dz. </li>
<li><code>"h2"</code> - half-length along y of the face at +dz. </li>
<li><code>"bl1"</code> - half-length along x of the side at y=-h1 of the face at -dz. </li>
<li><code>"bl2"</code> - half-length along x of the side at y=-h1 of the face at +dz. </li>
<li><code>"tl1"</code> - half-length along x of the side at y=+h1 of the face at -dz. </li>
<li><code>"tl2"</code> - half-length along x of the side at y=+h1 of the face at +dz. </li>
<li><code>"alp1"</code> - Angle with respect to the y axis from the centre of the side at y=-h1 to the centre at y=+h1 of the face at -dz. </li>
<li><code>"alp2"</code> -Angle with respect to the y axis from the centre of the side at y=-h1 to the centre at y=+h1 of the face at +dz.</li>
</ul>
<h3><a class="anchor" id="Shape_text">
Text (Label)</a></h3>
<p>Shape for visualizing 2D text aligned with the camera plane. The text is not scaled according to the distance from the camera, and is not influenced by rotation or scaling as 3D primitives are.</p>
<p>Both names: "Text" and "Label" are accepted</p>
<p>Available Geometry Properties: </p>
<ul>
<li><code>"x"</code>,"y","z" - position of the shape </li>
<li><code>"position"</code> - position of the shape specified as a string of 3 floats (for x, y and z); alternative to the <code>"x"</code>, <code>"y"</code> and <code>"z"</code> properties </li>
<li><code>"text"</code> - string with text to write </li>
<li><code>"fontname"</code> - The font name is recognized with the form "family:style". The range of supported font families depends on which fonts are installed on the system. A typical font family might be "arial" or "times". Style is either <code>"bold"</code>, <code>"italic"</code> or <code>"bold italic"</code>. </li>
<li><code>"fontsize"</code> - integer with the size of the font, in pixels.</li>
</ul>
<h3><a class="anchor" id="Shape_textFlat">
TextFlat</a></h3>
<p>Shape for visualizing a flat text (without depth), yet in 3D. Conversely to the <code>Text</code> (<code>Label</code>), the <code>TextFlat</code> shapes are scaled according to camera position, and influenced by rotation and scaling primitives</p>
<p>Available Geometry Properties: </p>
<ul>
<li><code>"x"</code>,"y","z" - position of the shape </li>
<li><code>"position"</code> - position of the shape specified as a string of 3 floats (for x, y and z); alternative to the <code>"x"</code>, <code>"y"</code> and <code>"z"</code> properties </li>
<li><code>"text"</code> - string with text to write </li>
<li><code>"fontname"</code> - The font name is recognized with the form "family:style". The range of supported font families depends on which fonts are installed on the system. A typical font family might be "arial" or "times". Style is either <code>"bold"</code>, <code>"italic"</code> or <code>"bold italic"</code>. </li>
<li><code>"fontsize"</code> - integer with the size of the font, in pixels.</li>
</ul>
<h3><a class="anchor" id="Shape_text3D">
Text3D</a></h3>
<p>Shape for visualizing a 3D text. Conversely to the <code>Text</code> (<code>Label</code>), the <code>TextFlat</code> shapes are scaled according to camera position, and influenced by rotation and scaling primitives</p>
<p>Available Geometry Properties: </p>
<ul>
<li><code>"x"</code>,"y","z" - position of the shape </li>
<li><code>"position"</code> - position of the shape specified as a string of 3 floats (for x, y and z); alternative to the <code>"x"</code>, <code>"y"</code> and <code>"z"</code> properties </li>
<li><code>"text"</code> - string with text to write </li>
<li><code>"fontname"</code> - The font name is recognized with the form "family:style". The range of supported font families depends on which fonts are installed on the system. A typical font family might be "arial" or "times". Style is either <code>"bold"</code>, <code>"italic"</code> or <code>"bold italic"</code>. </li>
<li><code>"fontsize"</code> - integer with the size of the font, in pixels.</li>
</ul>
<h3><a class="anchor" id="Shape_axis">
Axis</a></h3>
<p>Shape that represents a coordinate axis.</p>
<p>Available Geometry Properties: </p>
<ul>
<li><code>"x"</code>,"y","z" - position of the shape </li>
<li><code>"position"</code> - position of the shape specified as a string of 3 floats (for x, y and z); alternative to the <code>"x"</code>, <code>"y"</code> and <code>"z"</code> properties </li>
<li><code>"ndiv"</code> - integer with number of divisions in each axis. </li>
<li><code>"divlength"</code> - float with the size of each division.</li>
</ul>
<h3><a class="anchor" id="Shape_Polyhedra">
Polyhedra</a></h3>
<p>Shape that represents a polyhedron.</p>
<p>Available Geometry Properties: </p>
<ul>
<li><code>"x"</code>,"y","z" - position of the shape </li>
<li><code>"position"</code> - position of the shape specified as a string of 3 floats (for x, y and z); alternative to the <code>"x"</code>, <code>"y"</code> and <code>"z"</code> properties </li>
<li><code>"startphi"</code> - initial phi. </li>
<li><code>"deltaphi"</code> - delta phi. </li>
<li><code>"npdv"</code> - number of steps along phi. </li>
<li><code>"zsections"</code> - string with a list of z planes. The format is: <code>"z,radiusmin,radiusmax,z,radiusmin,radiusmax,z..."</code>.</li>
</ul>
<h2><a class="anchor" id="propmods">
Getting/ modifying shape properties</a></h2>
<p>The properties (geometrical and visual) of each object can be modified using a set of provided functions.</p>
<p>To move the shape to another position, or change its geometry, or rotation, one may use <a class="el" href="classfw3DViewer.html#adecae349a32f49fd6e9519930d554278">fw3DViewer::setGeometry</a></p>
<p>To change the color of the shape, use <a class="el" href="classfw3DViewer.html#ada3f89eb0d054c14522b06d9be1a9bea">fw3DViewer::setColor</a> or <a class="el" href="classfw3DViewer.html#ab906ba537f0bd9ba7fe8196157fd61dd">fw3DViewer::setColorRGB</a></p>
<p>To change the transparency of the shape, use <a class="el" href="classfw3DViewer.html#aa5cafa1e38af33f51b61203fb9db14c2">fw3DViewer::setTransparency</a></p>
<p>To get the properties of a shape one could use the <a class="el" href="classfw3DViewer.html#a8e722bd62fc720bcc6d56404673df0d6">fw3DViewer::getShapeInfo</a> function, passing the list of properties names to be queried as a parameter.</p>
<h2><a class="anchor" id="grouping">
Grouping of objects</a></h2>
<p>The objects may be put in the groups. By default, if they are created using the <a class="el" href="classfw3DViewer.html#a85466111a13e1352177c80b367c200d7">fw3DViewer::addShape</a> function, they are put in a flat structure, in the toplevel (default) group called <code>"root"</code> .</p>
<p>One may create other groups using the <a class="el" href="classfw3DViewer.html#a70c4ce634ae1d0f871378b353351734a">fw3DViewer::addGroup</a> function, then add objects to a specific group by using <a class="el" href="classfw3DViewer.html#a6974add94de1ac77b3ea513e64028d8e">fw3DViewer::addShapeInGroup</a> . Note that <a class="el" href="classfw3DViewer.html#a70c4ce634ae1d0f871378b353351734a">fw3DViewer::addGroup</a> allows to have nested groups.</p>
<p>The grouping of the object allows to change the properties of many objects at once in a simple way. One may use the group name instead of a shape name in functions such as <a class="el" href="classfw3DViewer.html#ada3f89eb0d054c14522b06d9be1a9bea">fw3DViewer::setColor</a> or <a class="el" href="classfw3DViewer.html#aa5cafa1e38af33f51b61203fb9db14c2">fw3DViewer::setTransparency</a> , and the properties of all members of a group will be changed. This allows, for instance, to hide a big part of the scene, containing a lot of elements, by setting the transparency of the group containing all these objects to 100%.</p>
<p>Note that an object may not simply be moved from one group to another</p>
<h2><a class="anchor" id="deleting">
Deleting the objects, cleaning the scene</a></h2>
<p>One may delete an existing object using <a class="el" href="classfw3DViewer.html#a2b0eca10eb7c23655340d077c9a02aa8">fw3DViewer::delShape</a> function. To clean the complete scene, one may specify the name of the toplevel group ("root") as the parameter, i.e. </p>
<div class="fragment"><pre class="fragment"> myShape.delShape(<span class="stringliteral">&quot;root&quot;</span>);
</pre></div> </div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 29 May 2013 for fw3DViewer:&nbsp;3D-Viewer&nbsp;widget by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
